<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="notice">

	<select id="count" parameterType="board.notice.NoticeVO" resultType="Integer">

		SELECT COUNT(*) FROM notice 
		<where>
			<if test="sval != null and sval !='' and stype != 'all'">
				${stype} LIKE '%${sval}%'
			</if>
			<if test="sval != null and sval !='' and stype == 'all'">
				title LIKE '%${sval}%'
				or no in
				(SELECT no FROM notice WHERE content LIKE '%${sval)%')
			</if>
		</where>
		
	
	</select>


	<select id="list" parameterType="board.notice.NoticeVO" resultType="board.notice.NoticeVO">
		
		SELECT * FROM notice 
		<where>
		<if test="sval != null and sval !='' and stype != 'all'">
			${stype} like '%${sval}%'
		</if>
		<if test="sval != null and sval !='' and stype == 'all'">
				title LIKE '%${sval}%'
				or no in
				(SELECT no FROM notice WHERE content LIKE '%${sval}%')
		</if>
		</where>
		ORDER BY no DESC LIMIT #{startRow}, #{size}
	 
	</select>
	
	<insert id="write" parameterType="board.notice.NoticeVO" useGeneratedKeys="true">
		INSERT INTO notice
			(no,writer,title,regDate,readCnt,content)
		VALUES
			(#{no},#{writer},#{title},now(),0,#{content})
	</insert>

	<select id ="view" parameterType="board.notice.NoticeVO" resultType="board.notice.NoticeVO">
		SELECT
			no, writer, title, content, regdate, filename
		FROM notice
		where no=#{no}
	</select>
	<update id ="readCnt" parameterType="board.notice.NoticeVO">
		UPDATE notice SET
			readCnt=#{readCnt}+1
		WHERE no=#{no}
	</update>
	
	
	
	<update id="modify" parameterType="board.notice.NoticeVO">
		UPDATE notice SET
			title = #{title} , content = #{content}, moddate = now(), filename=#{filename}
		where no=#{no}
	</update>
	
	<update id="delete" parameterType="Integer">
		DELETE FROM notice
		WHERE no=#{no}
	</update>



</mapper>

