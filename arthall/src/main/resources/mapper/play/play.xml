<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="play">

	<select id = "count" parameterType="play.PlayVO" resultType="Integer">
		SELECT COUNT(*) FROM play
		<where>
			<if test="stype != 'all' and sval != null and sval != ''">
				${stype} like '%${sval}%'
			</if>
			<if test="stype == 'all' and sval != null and sval !=''">
				playName like '%${sval}%' OR actor like '%${sval}%'
			</if>
		</where>
	</select>
	
	<select id = "list" parameterType="play.PlayVO" resultType="play.PlayVO">
		SELECT * FROM play 
		<where>
			<if test="stype != 'all' and sval != null and sval != ''">
				${stype} like '%${sval}%'
			</if>
			<if test="stype == 'all' and sval != null and sval !=''">
				playName like '%${sval}%' OR actor like '%${sval}%'
			</if>
		</where>
		ORDER BY regDate DESC LIMIT #{startRow}, #{size}
	</select>
	
	<insert id = "write" parameterType="play.PlayVO" useGeneratedKeys="true">
		INSERT INTO play
			(playName, startDate, endDate, runtime, hallNo, actor, content,
			fileName, playType, priceA, priceB, priceC, exhPrice, regDate, modDate)
		VALUES
			(#{playName}, #{startDate}, #{endDate}, #{runtime}, #{hallNo},
			#{actor}, #{content}, #{filename}, #{playType}, #{priceA}, #{priceB},
			#{priceC}, #{exhPrice}, now(), now());
		<selectKey keyProperty="no" resultType="Integer" order="AFTER">
			SELECT last_insert_id();
		</selectKey>
	</insert>
	
	<delete id = "delete" parameterType="play.PlayVO">
		DELETE FROM play WHERE no = #{no}
	</delete>
	
	<update id = "modify" parameterType="play.PlayVO">
		UPDATE play SET
		playName = #{playName},
		startDate = #{startDate},
		endDate = #{endDate},
		runtime = #{runtime},
		hallNo = #{hallNo},
		actor = #{actor},
		content = #{content},
		fileName = #{filename},
		playType = #{playType},
		priceA = #{priceA},
		priceB = #{priceB},
		priceC = #{priceC},
		exhPrice = #{exhPrice},
		moddate = now()
		WHERE no = #{no};
	</update>
	
	<select id = "modifyView" parameterType="play.PlayVO" resultType="play.PlayVO">
		SELECT * FROM play WHERE no = #{no};
	</select>
</mapper>